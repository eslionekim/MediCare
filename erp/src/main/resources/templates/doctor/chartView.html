<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>

    <title>MediCare</title>
	<!-- 구글 폰트 링크 -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>/* 전체 리셋 및 기본 배경 */
		
	html, body {
		height: 100%;
		overflow: hidden;        /* 화면 전체 스크롤 막기 */
	}
	body {
	    margin: 0;
	    padding: 0;
	    font-family: 'Inter', '맑은 고딕', sans-serif;
	    background-color: #D5DDED; /* 이미지의 연한 푸른색 배경 */
	
	}
	
	
	/* 상단 헤더 배경 및 레이아웃 */
	.top-bar {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    padding: 5px 15px;
	    background-color: #ffffff; /* 흰색 배경 */
	    font-size: 14px;
	}
	
	/* 상단 헤더 텍스트 스타일 */
	.user-info {
	    color: #555;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 배열 */
	.action-buttons {
	    display: flex;
	    gap: 5px;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 공통스타일 */
	.action-buttons button {
	    padding: 4px 12px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-weight: 500;
	    font-size: 13px;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 로그아웃 버튼 스타일 */
	.btn-logout {
		padding: 4px 12px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-weight: 500;
		font-size: 13px;
		color: white;
	    background-color: #FF4B4B;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 출근 버튼 스타일 */
	.time-in {
	    background-color: var(--ui-panel-title);
		color:#ffffff;
	}
	
	/* 상단 헤더 -> 퇴근 버튼 스타일 */
	.time-out {
	    background-color: #D5DDED;
	    color: #000;
	}

	/* 중앙 헤더 -> 카테고리 배치 */
	.tab-list {
	    list-style: none; /* 앞에 점 제거*/
	    margin: 0;
	    padding: 0;
	    display: flex; /* 가로 나열*/
	}
	
	/* 중앙 헤더 -> 카테고리 요소 스타일 */
	.tab-item a {
	    display: block;
	    padding: 8px 15px;
	    text-decoration: none; /* 카테고리 밑줄 제거*/
	    color: #333; /* 글자 색*/
	    background-color: transparent; /* 배경색 투명 (nav-tabs의 배경색 사용) */
	    border: none; /* 경계선 제거 */
	    font-size: 14px;
	    font-weight: normal;
	}
	
	/* 2. 중앙 헤더 공통 ⭐ */
	.nav-tabs {
		background-color: #D5DDED; /* 이미지의 균일한 하늘색 배경 */
		padding: 0 10px;
	}
	
	/* 중앙 헤더 -> 카테고리 호버 */
	.tab-item:hover {
	    background-color: rgba(255, 255, 255, 0.3); /* 마지막 숫자가 컬러 세기 정도*/
	}
	
	/* 중앙 헤더 -> 선택된 카테고리 스타일 */
	.tab-item.active a {
	    color: #333; /* 텍스트 색상은 검은색 유지 (사진처럼) */
	    font-weight: 550;
	    /* 하단에 진한 파란색 선으로 강조 */
	}
	
	
	/* 3. 하단 헤더  */
	.sub-menu {
	    background-color: #BACCFF; /* 흰색 배경 */
	    padding: 5px 15px; /* 패딩을 줄여서 메뉴와 붙은 느낌 */
	    font-size: 14px;
	    color: #555;
		font-weight: 530;
	    /* 이미지처럼 '금일 진료 리스트' 텍스트를 진하게 표현 */
	}
	
	/* 컨텐츠 영역 (전체 배경색 확인용) */
	.content-area {
		display: grid;
		height: calc(100vh - 130px);  /* 화면 높이에서 헤더 뺀 값 */
		overflow: hidden;              /* 밖으로 넘치는 건 숨김 */
	    background-color: #D5DDED; /* 나머지 화면을 덮는 배경색 */
	}
	
	/* 금일 진료 리스트 */
	#table{ /* div 영역 및 레이아웃 */
		margin:5px;
		margin-left: auto;
		margin-right: auto;
	}
	
	table { 
	    width: 100%; /* 너비 */
	    border-collapse: collapse; /* 표 한줄로 합치기 */
	    font-size: 13px;
	    background-color: white;
		margin:5px 0px;
	 }

	 th, td {
	     border: 1px solid #7B7B7B; /* 칸 당 테두리*/
	     padding: 0;
		 height: 25px; /* 원하는 셀 높이 */
	     text-align: center; /* 텍스트 중앙 */
	 }

	 th {
	     background-color: var(--ui-panel-title); 
		 font-weight: normal; /* 글씨 굵기 보통으로 */
		 color: rgb(31, 31, 31);
	 }

	 /* 접수 시작 */
	 .first {
		 display: flex;             /* flex로 변환 */
		 justify-content: center;   /* 가로 중앙 */
		 align-items: center;       /* 세로 중앙 */
		 width: 100%;               /* 가로 꽉 */
		 height: 100%;              /* 세로 꽉 */
		 box-sizing: border-box;    /* 패딩 포함 계산 */
		 border: none;
		 background-color: #00FF08;
		 color: black;
		 cursor: pointer;
		 font-size: 14px;
		 font-weight: 300; /* 글씨 굵기 보통으로 */
		 text-decoration: none;
	  }
	
	/* 공통 박스 스타일 */
	.patient_visit, .patient_bed, .diseases, .fee, .soap {
	    border: 1px solid #7B7B7B;
	    background-color: #ffffff;
	    padding: 4px 6px;
	    box-sizing: border-box;
	}
	
	.box{
		border: 1px solid #7B7B7B; /* 칸 당 테두리*/
		margin: 5px;
		border:1px solid #7B7B7B;
		margin:2px; /* 박스 간 간격 */
		padding:4px 6px; /* 박스 - 안쪽 (위아래,좌우) */
		background-color: #ffffff;
		
	}
	
	.patient_info{ /* 환자 정보 레이아웃*/
		grid-column: 1/2;
		grid-row: 1/2;
	}

	/* 표 전체 */
	.patient-table {
	  width:100%; /* 가로 꽉 채우기 */
	  border-collapse:collapse;
	  font-size:13px;
	}
	
	.title{ /* 환자정보 */
			background-color: var(--ui-panel-title); 
			color:#ffffffff; 
			margin: 0px; 
			display:inline-block;
			padding:2px 20px;
	 		font-size: 13px;
	}
	
	/* 환자 정보 -> 라벨 */
	.patient-table th {
	  width:70px;            /* 라벨 너비 */
	  text-align:center; /* 텍스트 가운데 정렬*/
	  background:#ffffff;    
	}

	/* 환자 정보 -> 라벨, 인풋 위아래 여백 줄이기*/ 
	.patient-table th,
	.patient-table td {
	  padding-top: 0;
	  padding-bottom: 0;
	  border:0;
	}

	/* 환자 정보 -> 인풋 박스 */
	.patient-table input[readonly] {
	  width:100%;
	  box-sizing:border-box;
	  border:1px solid #7B7B7B;
	  background:#D5DDED;    /* 회색 박스 색 */
	  padding:2px 4px;
	  font-size:13px;
	}
	/* 전체 레이아웃 */
	.content-area {
	    display: grid;
	    grid-template-columns: 1fr 3fr; /* 2:3 비율 */
	    gap: 1px;
	    height: calc(100vh - 100px); /* 상단 여백 제외 화면 전체 높이 */
	}

	/* 왼쪽 / 오른쪽 컨테이너 */
	.left-area {
	    display: flex;
	    flex-direction: column;
	    gap: 15px;
	}

	.right-area {
	    display: flex;
	    flex-direction: column;
	    gap: 15px;
	}

	/* 공통 박스 스타일 */
	.box {
	    border: 1px solid #ccc;
	    border-radius: 10px;
	    padding: 15px;
	    background: #fafafa;
	}

	/* 높이 설정 */
	.patient_info {
	    flex: 0 0 auto; /* 내용 만큼만 */
	}

	.patient_visit {
	    flex: 1 1 auto;  /* 남은 공간 채우기 */
	}

	/* 우측 영역 높이 비율 */
	.patient_soap {  /* 차트 입력 폼 */
	    flex: 0 0 auto;
	}

	.diseases {      /* 상병코드 */
	    flex: 1 1 40%;
	}

	.fee,
	.fee-drug {      /* 처방 영역 */
	    flex: 1 1 60%;
	}

	/* 스크롤 영역 지정 */
	.patient_visit,
	.diseases,
	.fee,
	.fee-drug {
	    max-height: 100%;
	    overflow-y: auto;
	}

	/* 저장버튼 오른쪽 하단 */
	.save-btn {
	    position: fixed;
	    right: 40px;
	    bottom: 30px;
	    padding: 12px 25px;
	    font-size: 16px;
	}


	/* 차트 입력폼 제목 */
	.patient_soap h3.title {
	    margin: 0 0 5px 0;
	    font-size: 16px;
	    font-weight: bold;
	}

	/* 차트 입력폼 textarea */
	.patient_soap textarea {
	    font-size: 13px;
	}

	/* 차트 입력 폼 레이아웃 정리 */
	.patient_soap .soap-grid {
	    display: grid;
	    grid-template-columns: repeat(3, minmax(0, 1fr));
	    gap: 10px 12px;
	    align-items: start;
	}

	.patient_soap .soap-field {
	    display: flex;
	    flex-direction: column;
	    gap: 6px;
	}

	.patient_soap .soap-field label {
	    font-size: 13px;
	    color: #333;
	}

	.patient_soap .soap-field textarea {
	    width: 100%;
	    box-sizing: border-box;
	    border: 1px solid #7B7B7B;
	    background-color: #ffffff;
	    padding: 6px 8px;
	    border-radius: 6px;
	    resize: vertical;
	}

	.patient_soap .soap-field.wide {
	    grid-column: span 2;
	}
	
    </style>
<link rel="stylesheet" th:href="@{/css/common-base.css}">

    <script th:src="@{/js/header-actions.js}" defer></script>
	
</head>
<body>
    <header class="main-header">
		<!-- 상단 헤더 -->
        <div class="top-bar">
            <div class="user-info">
                <span>MediCare |</span>
                <span>사용자ID: </span>
                <span th:text="${userId}"></span>
            </div>
            <div class="user-info">
                <span th:text="${userName}">진료과 ㅇㅇㅇ</span>
				<button class="btn-logout" data-action="logout">로그아웃</button>
			</div>
            <div class="action-buttons">
                <button class="time-in" data-action="time-in">출근</button>
                <button class="time-out" data-action="time-out">퇴근</button>
            </div>
        </div>
		<!-- 상단 헤더 끝-->
		
		<!-- 중앙 헤더-->
        <nav class="nav-tabs">
            <ul class="tab-list">
				<li class="tab-item"><a th:href="@{/doctor/todayVisits}">금일 진료 리스트</a></li>
				<li class="tab-item"><a th:href="@{/doctor/allVisits}">전체 진료 리스트</a></li>
				<li class="tab-item"><a th:href="@{/doctor/mySchedule}">스케줄 조회</a></li>
				<li class="tab-item"><a th:href="@{/doctor/verifyPassword}">마이페이지</a></li>
			</ul>
        </nav>
		<!-- 중앙 헤더 끝-->
		
		<!-- 하단 헤더-->
        <div class="sub-menu">
            <span> 차트 작성</span>
        </div>
		<!-- 하단 헤더 끝-->
    </header>

	<!-- 콘텐츠 영역 시작-->
	<div class="content-area container">
		<div class="left-area">
		<!-- 1. 환자 정보 -->
		<div class="box patient_info">
		    <div class="patient-tabs">
		        <span class="title">환자 정보</span>
		        <span class="chart_id"><input type="text" th:value="${chart != null ? chart.chart_id : ''}" readonly></span>
		    </div>

		    <table class="patient-table">
		        <tr>
		            <th>환자ID</th>
		            <td><input type="text" th:value="${patient != null ? patient.patient_id : ''}" readonly></td>
		            <th>초/재진</th>
		            <td><input type="text" th:value="${visit != null ? visit.visit_type : ''}" readonly></td>
		        </tr>
		        <tr>
		            <th>환자명</th>
		            <td><input type="text" th:value="${patient != null ? patient.name : ''}" readonly></td>
		            <th>성별</th>
		            <td><input type="text" th:value="${patient != null ? patient.gender : ''}" readonly></td>
		        </tr>
		        <tr>
		            <th>생년월일</th>
					<td colspan="3"><input type="text" th:value="${patient != null ? patient.birth_date : ''}" readonly></td>
		        </tr>
		        <tr>
		            <th>연락처</th>
		            <td colspan="3"><input type="text" th:value="${patient != null ? patient.phone : ''}" readonly></td>
		        </tr>
		        <tr>
		            <th>주소1</th>
		            <td colspan="3"><input type="text" th:value="${patient != null ? patient.address1 : ''}" readonly></td>
		        </tr>
		        <tr>
		            <th>주소2</th>
		            <td colspan="3"><input type="text" th:value="${patient != null ? patient.address2 : ''}" readonly></td>
		        </tr>
				<tr>
					<th>진료과</th>
					<td><input type="text" th:value="${visit != null && visit.department != null ? visit.department.name : ''}" readonly></td>
					<th>입원/외래</th>
					<td><input type="text" value="외래" readonly></td>
				</tr>
				<tr>
					<th>병상</th>
					<td><input type="text" value="해당 없음" readonly></td>
					<th>당일/예약</th>
					<td><input type="text" th:value="${visit != null ? visit.visit_route : ''}" readonly></td>
				</tr>
		    </table>
		</div>


	    <!-- 2. 외래 history 정보 -->
		<div class="box patient_visit" style="max-height:300px; overflow-y:auto;">
			<div class="patient-tabs">
				  <span class="title">외래 history 정보</span>
			</div>
	        <table class="patient_visit table">
	            <thead>
	                <tr>
	                    <th>방문일자</th>
						<th>담당 의사</th>
	                    <th>초/재진</th>
	                    <th>진료과</th>
	                    <th>증상</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="visit : ${pastVisits}">
	                    <td th:text="${visit.visit_datetime}"></td>
	                    <td th:text="${visit.user_account != null ? visit.user_account.name : ''}"></td>
	                    <td th:text="${visit.visit_type}"></td>
	                    <td th:text="${visit.department != null ? visit.department.name : ''}"></td>
	                    <td th:text="${visit.note}"></td>
	                </tr>
	            </tbody>
	        </table>
	    </div>
		</div>

		<div class="right-area">
	    <!-- 3. 차트 입력 폼 -->
		<form th:action="@{/doctor/chartSave}" method="post" onsubmit="return chartWriteForm()">
	    <div class="box patient_soap">
			
	        <h3 class="title">차트 정보</h3>
				<input type="hidden" name="chart_id" th:value="${chart != null ? chart.chart_id : ''}">
			    <input type="hidden" name="visit_id" th:value="${chart != null && chart.visit != null ? chart.visit.visit_id : ''}">
				<input type="hidden" name="patient_id" th:value="${chart != null && chart.visit != null && chart.visit.patient != null ? chart.visit.patient.patient_id : ''}">
			<div class="soap-grid">
				<div class="soap-field">
		            <label for="subjective">주증상 (Subjective)</label>
		            <textarea id="subjective" name="subjective" rows="3" th:text="${chart.subjective}" readonly></textarea>
				</div>

				<div class="soap-field">
		            <label for="objective">객관적 검사 (Objective)</label>
		            <textarea id="objective" name="objective" rows="3" th:text="${chart.objective}" readonly></textarea>
				</div>

				<div class="soap-field">
		            <label for="assessment">평가 및 진단 (Assessment)</label>
		            <textarea id="assessment" name="assessment" rows="3" th:text="${chart.assessment}" readonly></textarea>
				</div>

				<div class="soap-field wide">
		            <label for="plan">계획 및 치료 (Plan)</label>
		            <textarea id="plan" name="plan" rows="3" th:text="${chart.plan}" readonly></textarea>
				</div>

				<div class="soap-field">
		            <label for="note">진료 메모 (Note)</label>
		            <textarea id="note" name="note" rows="3" th:text="${chart.note}" readonly></textarea>
				</div>
			</div>

	            
	        
	    </div>
		
		<!-- 4. 상병코드 폼 -->
		<div class="box diseases" style="max-height:100px; overflow-y:auto;">
			<p class="title">상병코드</p>
			<table id="diseases">
			            <thead>
			                <tr>
								<th>코드</th>
			                    <th>증상명</th>
			                    <th>영문명</th>
			                    <th>진료과</th>
			                </tr>
			            </thead>
			            <tbody>
			                <tr th:each="disease : ${diseases_code}">
								<td><input name="diseases_code[]"  th:value="${disease.diseases_code}" readonly></td>
								<td><input name="name_kor[]" th:value="${disease.name_kor}" readonly></td>
								<td><input name="name_eng[]" th:value="${disease.name_eng}" readonly></td>
								<td><input name="department[]" th:value="${disease.department}" readonly></td>
			                </tr>
			            </tbody>
			        </table>
		</div>
		
		<!-- 5. 처방 폼 -->
		<div class="box fee" style="max-height:100px; overflow-y:auto;">
			<p class="title">처방</p>
			<table id="fee">
	            <thead>
	                <tr>
						<th>코드</th>
	                    <th>분류</th>
	                    <th>명칭</th>
	                    <th>단가</th>
						<th>수량/일수</th>
	                </tr>
	            </thead>
	            <tbody>
	                <tr th:each="claim_item : ${normal_claim_items}">
						<td><input name="normal_fee_item_code[]" th:value="${claim_item.fee_item.fee_item_code}" readonly></td>
						<td><input name="category[]" th:value="${claim_item.fee_item.category}" readonly></td>
						<td><input name="name[]" th:value="${claim_item.fee_item.name}" readonly></td>
						<td><input name="base_price[]" th:value="${claim_item.fee_item.base_price}" readonly></td>
						<td><input name="normal_quantity[]" th:value="${claim_item.quantity}" readonly></td>
				
	                </tr>
	            </tbody>
	        </table>					
		</div>
		<!-- 6. 약품 처방 폼 -->
		<div class="box fee-drug" style="max-height:100px; overflow-y:auto;">
		    <p class="title">약품</p>

		    <table id="drugFee">
		        <thead>
		            <tr>
		                <th>코드</th>
		                <th>분류</th>
		                <th>명칭</th>
		                <th>단가</th>
		                <th>수량/횟수/일수</th>
		            </tr>
		        </thead>
				<tbody>
				<tr th:each="item : ${drug_items}">
				    <td><input th:value="${item.feeItemCode}" readonly></td>
				    <td><input th:value="${item.category}" readonly></td>
				    <td><input th:value="${item.name}" readonly></td>
				    <td><input th:value="${item.basePrice}" readonly></td>
				    <td class="drug-dose">
				        1회 <input th:value="${item.dose != null ? item.dose.intValue() : ''}" style="width:45px;" readonly> /
				        1일 <input th:value="${item.frequency}" style="width:45px;" readonly> 회 /
				        <input th:value="${item.days}" style="width:45px;" readonly> 일
				    </td>
				</tr>
				</tbody>

		    </table>
		</div>

		<button class="save-btn" type="button"
		    th:onclick="'window.location.href=\'/doctor/chartWrite?visit_id=' 
		    + ${visit.visit_id} + '&patient_id=' + ${patient.patient_id} + '\';'">
		    수정
		</button>
		</form>
		</div>
	</div>
</body>
</html>
