<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>접수</title>
    <style>
        body {
            margin:0;
            padding:0;
            font-family:'Inter','맑은 고딕',sans-serif;
            background:#D5DDED;
        }
        .erp-page {
            width:1280px;
            margin:24px auto;
            background:#fff;
            box-shadow:0 4px 8px rgba(0,0,0,0.15);
        }

        .top-bar {
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:5px 15px;
            background:#fff;
            font-size:14px;
        }
        .user-info { color:#555; }
        .action-buttons { display:flex; gap:5px; }
        .action-buttons button,
        .btn-logout {
            padding:4px 12px;
            border-radius:4px;
            cursor:pointer;
            font-size:13px;
            font-weight:500;
            border:1px solid #7B7B7B;
        }
        .btn-logout { background:#FF4B4B; color:#fff; }
        .time-in { background:#879BD5; color:#fff; }
        .time-out { background:#D5DDED; }

        .nav-tabs { background:#D5DDED; padding:0 10px; }
        .tab-list { list-style:none; display:flex; padding:0; margin:0; }
        .tab-item a {
            display:block;
            padding:8px 15px;
            text-decoration:none;
            color:#333;
            font-size:14px;
        }
        .tab-item.active a { font-weight:600; }
        .sub-menu {
            background:#BACCFF;
            padding:5px 15px;
            font-size:14px;
            color:#555;
            font-weight:530;
        }

        .content-area { padding:10px; }
        .layout-two-column {
            display:flex;
            gap:12px;
            padding:10px;
            box-sizing:border-box;
        }
        .left-panel {
            flex:1.1;
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .right-panel {
            flex:1.9;
            display:flex;
            flex-direction:column;
            gap:10px;
        }

        .card {
            border:1px solid #b0b7c7;
            border-radius:4px;
            background:#f7f9ff;
        }
        .card-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:6px 10px;
            font-size:13px;
            font-weight:600;
            background:#879BD5;
            color:#fff;
        }
        .card-body {
            background:#fff;
            padding:10px;
        }

        .form-row {
            display:flex;
            gap:6px;
            margin-bottom:6px;
            font-size:13px;
            align-items:center;
        }
        .form-row label {
            width:70px;
            font-weight:500;
        }
        .form-row input,
        .form-row select,
        .form-row textarea {
            flex:1;
            padding:5px;
            border-radius:4px;
            border:1px solid #cbd2e1;
            font-size:13px;
        }
        .form-row textarea {
            min-height:60px;
            resize:vertical;
        }

        .history-table {
            width:100%;
            border-collapse:collapse;
            font-size:12px;
        }
        .history-table th,
        .history-table td {
            border:1px solid #ccc;
            padding:4px 5px;
            text-align:center;
        }
        .history-table th { background:#f3f6ff; }

        .tabs-small {
            display:flex;
            border-bottom:1px solid #b0b7c7;
            background:#f0f3ff;
        }
        .tabs-small div {
            padding:6px 12px;
            font-size:13px;
            cursor:pointer;
        }
        .tabs-small .active {
            background:#ffffff;
            border-left:1px solid #b0b7c7;
            border-right:1px solid #b0b7c7;
            border-top:2px solid #879BD5;
            font-weight:600;
        }

        .discount-row {
            display:flex;
            gap:4px;
            margin-top:6px;
            font-size:12px;
        }
        .discount-row div {
            flex:1;
            border:1px solid #cbd2e1;
            padding:4px 5px;
            text-align:center;
        }

        .summary-bar {
            font-size:13px;
            text-align:right;
        }

        .waiting-box {
            border:1px solid #b0b7c7;
            border-radius:4px;
            background:#ffffff;
            height:260px;
            overflow-y:auto;
            padding:6px;
            font-size:12px;
        }
        .waiting-header {
            display:flex;
            justify-content:space-between;
            font-size:13px;
            margin-bottom:4px;
        }
        .waiting-item {
            padding:3px 4px;
            border-bottom:1px solid #eee;
            display:flex;
            justify-content:space-between;
        }
    </style>
</head>
<body>
<div class="erp-page">
    <!-- 상단 바 -->
    <div class="top-bar">
        <div class="user-info">
            <span>(아이콘)</span>
            <span>MediCare |</span>
            <span>사용자ID:</span>
        </div>
        <div class="user-info">
            <span>원무과</span>
            <button class="btn-logout">로그아웃</button>
        </div>
        <div class="action-buttons">
            <button class="time-in">출근</button>
            <button class="time-out">퇴근</button>
        </div>
    </div>

    <!-- 상단 탭 -->
    <nav class="nav-tabs">
        <ul class="tab-list">
            <li class="tab-item"><a th:href="@{/patients}">환자 등록 및 수정</a></li>
            <li class="tab-item active"><a th:href="@{/receptions}">접수</a></li>
            <li class="tab-item"><a href="#">예약 받기</a></li>
            <li class="tab-item"><a href="#">수납</a></li>
            <li class="tab-item"><a href="#">휴가 신청</a></li>
            <li class="tab-item"><a href="#">스케줄 조회</a></li>
        </ul>
    </nav>

    <div class="sub-menu">접수</div>

    <div class="content-area">
        <div class="layout-two-column">

            <!-- ================= 왼쪽 : 환자 정보 + 히스토리 ================= -->
            <section class="left-panel">

                <!-- 환자 정보 -->
                <section class="card">
                    <div class="card-header">
                        <span>환자 정보</span>
                        <!-- 추후 "변경" 버튼 필요하면 여기에 -->
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <label>환자ID</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.patient_id : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>환자명</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.name : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>생년월일</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.birth_date : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>연락처</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.phone : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>주소1</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.address1 : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>주소2</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.address2 : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>메모</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.note : ''}"
                                   readonly />
                        </div>
                        <div class="form-row">
                            <label>이메일</label>
                            <input type="text"
                                   th:value="${selectedPatient != null ? selectedPatient.email : ''}"
                                   readonly />
                        </div>
                    </div>
                </section>

                <!-- 외래 history -->
                <section class="card">
                    <div class="card-header">외래 history 정보</div>
                    <div class="card-body">
                        <table class="history-table">
                            <thead>
                            <tr>
                                <th>내원일시</th>
                                <th>진료과</th>
                                <th>진료의사</th>
                                <th>초/재진</th>
                                <th>증상/메모</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="h : ${visitHistories}">
                                <td th:text="${#temporals.format(h.visitDatetime, 'yyyy-MM-dd HH:mm')}"></td>
                                <td th:text="${h.departmentCode}"></td>
                                <td th:text="${h.doctorId}"></td>
                                <td th:text="${h.visitType}"></td>
                                <td th:text="${h.note}"></td>
                            </tr>
                            <tr th:if="${visitHistories == null or #lists.isEmpty(visitHistories)}">
                                <td colspan="5">&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- 입원 history (추후 구현) -->
                <section class="card">
                    <div class="card-header">입원 history 정보</div>
                    <div class="card-body">
                        <table class="history-table">
                            <thead>
                            <tr>
                                <th>입원일자</th>
                                <th>퇴원일자</th>
                                <th>진료의사</th>
                                <th>증상</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td colspan="4">&nbsp;</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

            </section>

            <!-- ================= 오른쪽 : 외래 접수 + 대기자 관리 ================= -->
            <section class="right-panel">

                <!-- 외래 / 입원 탭 -->
                <div class="tabs-small">
                    <div class="active">외래 접수 정보</div>
                    <div>입원 접수 정보</div>
                </div>

                <!-- 외래 접수 폼 -->
                <section class="card">
                    <div class="card-body">
                        <form th:action="@{/receptions/save}" method="post">

                            <!-- 선택 환자 ID -->
                            <input type="hidden" name="patientId"
                                   th:value="${selectedPatient != null ? selectedPatient.patient_id : ''}" />

                            <div class="form-row">
                                <label>진료과</label>
                                <select name="departmentCode" required>
                                    <option value="">선택</option>
                                    <option th:each="d : ${departments}"
                                            th:value="${d}"
                                            th:text="${d}">
                                    </option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>진료의사</label>
                                <!-- 지금은 ID 직접 입력, 나중에 의사 목록 드롭다운으로 변경 -->
                                <input type="number" name="doctorUserId" placeholder="의사 user_id" required />
                            </div>

                            <div class="form-row">
                                <label>진료유형</label>
                                <select name="visitType">
                                    <option th:each="t : ${visitTypes}"
                                            th:value="${t}"
                                            th:text="${t}">
                                    </option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>내원경로</label>
                                <select name="visitRoute">
                                    <option th:each="r : ${visitRoutes}"
                                            th:value="${r}"
                                            th:text="${r}">
                                    </option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>할인코드</label>
                                <input type="text" name="insuranceCode" placeholder="보험/보훈/산재/자보 등" />
                            </div>

                            <div class="form-row">
                                <label>메모</label>
                                <textarea name="note"></textarea>
                            </div>

                            <!-- 보험/보훈, 산재/공상, 자보/자손, 일반/할인100 표시 영역 -->
                            <div class="discount-row">
                                <div>보험/보훈</div>
                                <div>산재/공상</div>
                                <div>자보/자손</div>
                                <div>일반/할인100</div>
                            </div>

                            <div style="text-align:right; margin-top:10px;">
                                <button type="submit" class="time-in">접수</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- 금일 접수 현황 + 대기자 관리 -->
                <div class="summary-bar">
                    금일 접수 현황:
                    <span th:text="${todayTotal}">0</span>명 /
                    대기인원:
                    <span th:text="${todayWaiting}">0</span>명
                </div>

                <section class="card">
                    <div class="card-header">
                        <span>대기자 관리</span>
                        <span th:text="${date != null ? #temporals.format(date, 'yyyy-MM-dd') : ''}"></span>
                    </div>
                    <div class="card-body">
                        <div class="waiting-box">
                            <div class="waiting-header">
                                <span>환자 / 진료과 / 의사</span>
                                <span>상태</span>
                            </div>

                            <div th:each="w : ${waitingVisits != null ? waitingVisits : {}}"
                                 class="waiting-item">
                                <span th:text="${w.visit_id}">1</span>
                                <span>
                                    <!-- 필요하면 여기서 patient/department 정보로 커스터마이징 -->
                                </span>
                                <span th:text="${w.statusCode != null ? w.statusCode : ''}"></span>
                            </div>

                            <div th:if="${waitingVisits == null or #lists.isEmpty(waitingVisits)}">
                                대기 중인 환자가 없습니다.
                            </div>
                        </div>
                    </div>
                </section>

            </section>
        </div>
    </div>
</div>
</body>
</html>
