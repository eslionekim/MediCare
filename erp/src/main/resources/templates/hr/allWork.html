<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>

    <title>MediCare</title>
	<!-- 구글 폰트 링크 -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>/* 전체 리셋 및 기본 배경 */
	body {
	    margin: 0;
	    padding: 0;
	    font-family: 'Inter', '맑은 고딕', sans-serif;
	    background-color: #D5DDED; /* 이미지의 연한 푸른색 배경 */
	
	}
	
	
	/* 상단 헤더 배경 및 레이아웃 */
	.top-bar {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    padding: 5px 15px;
	    background-color: #ffffff; /* 흰색 배경 */
	    font-size: 14px;
	}
	
	/* 상단 헤더 텍스트 스타일 */
	.user-info {
	    color: #555;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 배열 */
	.action-buttons {
	    display: flex;
	    gap: 5px;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 공통스타일 */
	.action-buttons button {
	    padding: 4px 12px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-weight: 500;
	    font-size: 13px;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 로그아웃 버튼 스타일 */
	.btn-logout {
		padding: 4px 12px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-weight: 500;
		font-size: 13px;
		color: white;
	    background-color: #FF4B4B;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 출근 버튼 스타일 */
	.time-in {
	    background-color: var(--ui-panel-title);
		color:#ffffff;
	}
	
	/* 상단 헤더 -> 퇴근 버튼 스타일 */
	.time-out {
	    background-color: #D5DDED;
	    color: #000;
	}

	/* 중앙 헤더 -> 카테고리 배치 */
	.tab-list {
	    list-style: none; /* 앞에 점 제거*/
	    margin: 0;
	    padding: 0;
	    display: flex; /* 가로 나열*/
	}
	
	/* 중앙 헤더 -> 카테고리 요소 스타일 */
	.tab-item a {
	    display: block;
	    padding: 8px 15px;
	    text-decoration: none; /* 카테고리 밑줄 제거*/
	    color: #333; /* 글자 색*/
	    background-color: transparent; /* 배경색 투명 (nav-tabs의 배경색 사용) */
	    border: none; /* 경계선 제거 */
	    font-size: 14px;
	    font-weight: normal;
	}
	
	/* 2. 중앙 헤더 공통 ⭐ */
	.nav-tabs {
		background-color: #D5DDED; /* 이미지의 균일한 하늘색 배경 */
		padding: 0 10px;
	}
	
	/* 중앙 헤더 -> 카테고리 호버 */
	.tab-item:hover {
	    background-color: rgba(255, 255, 255, 0.3); /* 마지막 숫자가 컬러 세기 정도*/
	}
	
	/* 중앙 헤더 -> 선택된 카테고리 스타일 */
	.tab-item.active a {
	    color: #333; /* 텍스트 색상은 검은색 유지 (사진처럼) */
	    font-weight: 550;
	    /* 하단에 진한 파란색 선으로 강조 */
	}
	
	
	/* 3. 하단 헤더  */
	.sub-menu {
	    background-color: #BACCFF; /* 흰색 배경 */
	    padding: 5px 15px; /* 패딩을 줄여서 메뉴와 붙은 느낌 */
	    font-size: 14px;
	    color: #555;
		font-weight: 530;
	    /* 이미지처럼 '금일 진료 리스트' 텍스트를 진하게 표현 */
	}
	
	/* 컨텐츠 영역 (전체 배경색 확인용) */
	.content-area {
	    min-height: 500px; /* 임시 높이 */
	    background-color: #D5DDED; /* 나머지 화면을 덮는 배경색 */
	}
	
	/* 금일 진료 리스트 */
	#table{ /* div 영역 및 레이아웃 */
		margin:5px;
		margin-left: auto;
		margin-right: auto;
	}
	
	table { 
	    width: 90%; /* 너비 */
	    border-collapse: collapse; /* 표 한줄로 합치기 */
	    font-size: 14px;
	    background-color: white;
		
	 }

	 th, td {
	     border: 1px solid #7B7B7B; /* 칸 당 테두리*/
	     padding: 0;
		 height: 25px; /* 원하는 셀 높이 */
	     text-align: center; /* 텍스트 중앙 */
	 }

	 th {
	     background-color: var(--ui-panel-title); 
		 font-weight: normal; /* 글씨 굵기 보통으로 */
		 color: rgb(31, 31, 31);
	 }

	 tr:nth-child(even) {
	     background-color: #ffffffff;
	 }

	 /* 접수 시작 */
	 .first {
		 display: flex;             /* flex로 변환 */
		 justify-content: center;   /* 가로 중앙 */
		 align-items: center;       /* 세로 중앙 */
		 width: 100%;               /* 가로 꽉 */
		 height: 100%;              /* 세로 꽉 */
		 box-sizing: border-box;    /* 패딩 포함 계산 */
		 border: none;
		 background-color: #00FF08;
		 color: black;
		 cursor: pointer;
		 font-size: 14px;
		 font-weight: 300; /* 글씨 굵기 보통으로 */
		 text-decoration: none;
	  }

	  .container {
	  	      display: grid;
	  	      grid-template-columns: 1fr 1fr; /* 왼쪽, 오른쪽 */
	  	      gap: 5px;
	  	      height: calc(100vh - 130px); /* 상단+중앙+하단 헤더 제외 */
	  	      padding: 5px;
	  	      box-sizing: border-box;
	  }
	  
	  .user{
		 grid-column: 1/2;
	  }
	  
	  .calendar{
		 grid-column: 2/3;
	  }
	  
	  .fc-event-title {  /*캘린더 줄띄어쓰기*/
  	        white-space: pre-line;
  	   }
	  .item-scroll {
 	      width: 90%;
 	      margin: 5px auto;
 	      max-height: 520px;
 	      overflow-y: auto;
 	      border: 1px solid #7B7B7B;
 	      background-color: #ffffff;
 	  }

 	  .item-scroll table {
 	      width: 100%;
 	  }
    </style>
<link rel="stylesheet" th:href="@{/css/common-base.css}">
	
	<!-- FullCalendar CSS/JS -->
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
	
</head>
<body>
	<div th:replace="~{fragments/hr-header :: header(title='근태 현황', activeTab='allWork')}"></div>


	<!-- 콘텐츠 영역 시작-->
    <div class="content-area">
		<div class="container">
			<div class="user"> <!-- 직원 영역-->
				<!-- 검색 영역 -->
				<div style="width:90%; margin: 5px auto; display:flex;  justify-content: center;">

				<form method="get" action="/hr/allWork" style="margin-bottom:10px;">
				    <!-- 진료과 -->
				    <select name="departmentCode">
				        <option value="">진료과 전체</option>
				        <option th:each="d : ${departments}"
				                th:value="${d.department_code}"
				                th:text="${d.name}"
				                th:selected="${d.department_code == departmentCode}">
				        </option>
				    </select>

				    <!-- 직원 ID / 이름 -->
				    <input type="text"
				           name="keyword"
				           placeholder="직원명 / ID"
				           th:value="${keyword}"/>

				    <button type="submit">검색</button>
				</form>
				</div>
				<div class="item-scroll">
				<table class="user-table">
			        <thead>
			            <tr>
			                <th>진료과</th>
			                <th>직원 ID</th>
			                <th>직원명</th>
			                <th>직함</th>
			                <th>선택</th>
			            </tr>
			        </thead>

			        <tbody>
			            <tr th:each="u : ${user}">
			                <!-- 진료과명 -->
			                <td th:text="${u.staff_profile[0].department.name}">
			                </td>

			                <!-- 직원 ID -->
			                <td th:text="${u.user_id}"></td>

			                <!-- 직원명 -->
			                <td th:text="${u.name}"></td>

			                <!-- 직함 (null이면 빈칸) -->
			                <td th:text="${u.staff_profile[0].position}">
			                </td>

			                <!-- 선택 버튼 -->
			                <td>
			                    <button type="button"
			                            class="select-user-btn"
			                            th:data-user-id="${u.user_id}">
			                        선택
			                    </button>
			                </td>
			            </tr>
						<tr th:if="${user.size() > 0 and user.size() < 20}" 
						        th:each="i : ${#numbers.sequence(user.size() + 1, 20)}">
						        <td>&nbsp;</td>
						        <td>&nbsp;</td>
						        <td>&nbsp;</td>
						        <td>&nbsp;</td>
						        <td>&nbsp;</td>
						</tr>

			        </tbody>
				</table>		
				</div>
			</div>
			
			<div class="calendar"> <!-- 캘린더 영역-->
				<div id="calendar-placeholder">직원을 선택해주세요</div>
				<div id="calendar" style="display:none;"></div>
			</div>
		</div>
	</div>
	<!-- 콘텐츠 영역 끝-->
	<script>
	let calendar;
	let selectedUserId = null;

	document.addEventListener('DOMContentLoaded', function () {

	    const calendarEl = document.getElementById('calendar');

	    calendar = new FullCalendar.Calendar(calendarEl, {
	        initialView: 'dayGridMonth',
	        locale: 'ko',
	        height: 'auto',

	        headerToolbar: {
	            left: 'prev,next today',
	            center: 'title',
	            right: ''
	        },

	        // 달 변경될 때마다 호출
	        datesSet: function (info) {

	            // 직원 선택 안 했으면 조회 안 함
	            if (!selectedUserId) return;

	            const currentDate = info.view.currentStart;
	            const year = currentDate.getFullYear();
	            const month = currentDate.getMonth() + 1;

				fetch(`/hr/allWork/schedule?userId=${selectedUserId}&year=${year}&month=${month}`)
	                .then(res => res.json())
	                .then(data => {
	                    calendar.removeAllEvents();
	                    calendar.addEventSource(data);
	                });
	        }
	    });

	    calendar.render();

	    // 직원 선택 버튼
	    document.querySelectorAll('.select-user-btn').forEach(btn => {
	        btn.addEventListener('click', () => {

	            selectedUserId = btn.dataset.userId;

	            // 안내 문구 제거
	            document.getElementById('calendar-placeholder')?.remove();
				
				// 캘린더 보이기
				document.getElementById('calendar').style.display = 'block';

	            // 현재 달 기준으로 강제 조회
	            calendar.gotoDate(calendar.getDate());
	        });
	    });
	});
	</script>


	


</body>
</html>