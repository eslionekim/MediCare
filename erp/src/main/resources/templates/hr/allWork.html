<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MediCare</title>
	<!-- êµ¬ê¸€ í°íŠ¸ ë§í¬ -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>/* ì „ì²´ ë¦¬ì…‹ ë° ê¸°ë³¸ ë°°ê²½ */
	body {
	    margin: 0;
	    padding: 0;
	    font-family: 'Inter', 'ë§‘ì€ ê³ ë”•', sans-serif;
	    background-color: #D5DDED; /* ì´ë¯¸ì§€ì˜ ì—°í•œ í‘¸ë¥¸ìƒ‰ ë°°ê²½ */
	
	}
	
	
	/* ìƒë‹¨ í—¤ë” ë°°ê²½ ë° ë ˆì´ì•„ì›ƒ */
	.top-bar {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    padding: 5px 15px;
	    background-color: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
	    font-size: 14px;
	}
	
	/* ìƒë‹¨ í—¤ë” í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
	.user-info {
	    color: #555;
	}
	
	/* ìƒë‹¨ í—¤ë” -> ë¡œê·¸ì•„ì›ƒ ì¶œê·¼ í‡´ê·¼ ë°°ì—´ */
	.action-buttons {
	    display: flex;
	    gap: 5px;
	}
	
	/* ìƒë‹¨ í—¤ë” -> ë¡œê·¸ì•„ì›ƒ ì¶œê·¼ í‡´ê·¼ ê³µí†µìŠ¤íƒ€ì¼ */
	.action-buttons button {
	    padding: 4px 12px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-weight: 500;
	    font-size: 13px;
		border: 1px solid #7B7B7B;
	}
	
	/* ìƒë‹¨ í—¤ë” -> ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
	.btn-logout {
		padding: 4px 12px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-weight: 500;
		font-size: 13px;
		color: white;
	    background-color: #FF4B4B;
		border: 1px solid #7B7B7B;
	}
	
	/* ìƒë‹¨ í—¤ë” -> ì¶œê·¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
	.time-in {
	    background-color: #879BD5;
		color:#ffffff;
	}
	
	/* ìƒë‹¨ í—¤ë” -> í‡´ê·¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
	.time-out {
	    background-color: #D5DDED;
	    color: #000;
	}

	/* ì¤‘ì•™ í—¤ë” -> ì¹´í…Œê³ ë¦¬ ë°°ì¹˜ */
	.tab-list {
	    list-style: none; /* ì•ì— ì  ì œê±°*/
	    margin: 0;
	    padding: 0;
	    display: flex; /* ê°€ë¡œ ë‚˜ì—´*/
	}
	
	/* ì¤‘ì•™ í—¤ë” -> ì¹´í…Œê³ ë¦¬ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
	.tab-item a {
	    display: block;
	    padding: 8px 15px;
	    text-decoration: none; /* ì¹´í…Œê³ ë¦¬ ë°‘ì¤„ ì œê±°*/
	    color: #333; /* ê¸€ì ìƒ‰*/
	    background-color: transparent; /* ë°°ê²½ìƒ‰ íˆ¬ëª… (nav-tabsì˜ ë°°ê²½ìƒ‰ ì‚¬ìš©) */
	    border: none; /* ê²½ê³„ì„  ì œê±° */
	    font-size: 14px;
	    font-weight: normal;
	}
	
	/* 2. ì¤‘ì•™ í—¤ë” ê³µí†µ â­ */
	.nav-tabs {
		background-color: #D5DDED; /* ì´ë¯¸ì§€ì˜ ê· ì¼í•œ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
		padding: 0 10px;
	}
	
	/* ì¤‘ì•™ í—¤ë” -> ì¹´í…Œê³ ë¦¬ í˜¸ë²„ */
	.tab-item:hover {
	    background-color: rgba(255, 255, 255, 0.3); /* ë§ˆì§€ë§‰ ìˆ«ìê°€ ì»¬ëŸ¬ ì„¸ê¸° ì •ë„*/
	}
	
	/* ì¤‘ì•™ í—¤ë” -> ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ìŠ¤íƒ€ì¼ */
	.tab-item.active a {
	    color: #333; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ ê²€ì€ìƒ‰ ìœ ì§€ (ì‚¬ì§„ì²˜ëŸ¼) */
	    font-weight: 550;
	    /* í•˜ë‹¨ì— ì§„í•œ íŒŒë€ìƒ‰ ì„ ìœ¼ë¡œ ê°•ì¡° */
	}
	
	
	/* 3. í•˜ë‹¨ í—¤ë”  */
	.sub-menu {
	    background-color: #BACCFF; /* í°ìƒ‰ ë°°ê²½ */
	    padding: 5px 15px; /* íŒ¨ë”©ì„ ì¤„ì—¬ì„œ ë©”ë‰´ì™€ ë¶™ì€ ëŠë‚Œ */
	    font-size: 14px;
	    color: #555;
		font-weight: 530;
	    /* ì´ë¯¸ì§€ì²˜ëŸ¼ 'ê¸ˆì¼ ì§„ë£Œ ë¦¬ìŠ¤íŠ¸' í…ìŠ¤íŠ¸ë¥¼ ì§„í•˜ê²Œ í‘œí˜„ */
	}
	
	/* ì»¨í…ì¸  ì˜ì—­ (ì „ì²´ ë°°ê²½ìƒ‰ í™•ì¸ìš©) */
	.content-area {
	    min-height: 500px; /* ì„ì‹œ ë†’ì´ */
	    background-color: #D5DDED; /* ë‚˜ë¨¸ì§€ í™”ë©´ì„ ë®ëŠ” ë°°ê²½ìƒ‰ */
	}
	
	/* ê¸ˆì¼ ì§„ë£Œ ë¦¬ìŠ¤íŠ¸ */
	#table{ /* div ì˜ì—­ ë° ë ˆì´ì•„ì›ƒ */
		margin:5px;
		margin-left: auto;
		margin-right: auto;
	}
	
	table { 
	    width: 90%; /* ë„ˆë¹„ */
	    border-collapse: collapse; /* í‘œ í•œì¤„ë¡œ í•©ì¹˜ê¸° */
	    font-size: 14px;
	    background-color: white;
		
	 }

	 th, td {
	     border: 1px solid #7B7B7B; /* ì¹¸ ë‹¹ í…Œë‘ë¦¬*/
	     padding: 0;
		 height: 25px; /* ì›í•˜ëŠ” ì…€ ë†’ì´ */
	     text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ */
	 }

	 th {
	     background-color: #879BD5; 
		 font-weight: normal; /* ê¸€ì”¨ êµµê¸° ë³´í†µìœ¼ë¡œ */
		 color: rgb(31, 31, 31);
	 }

	 tr:nth-child(even) {
	     background-color: #ffffffff;
	 }

	 /* ì ‘ìˆ˜ ì‹œì‘ */
	 .first {
		 display: flex;             /* flexë¡œ ë³€í™˜ */
		 justify-content: center;   /* ê°€ë¡œ ì¤‘ì•™ */
		 align-items: center;       /* ì„¸ë¡œ ì¤‘ì•™ */
		 width: 100%;               /* ê°€ë¡œ ê½‰ */
		 height: 100%;              /* ì„¸ë¡œ ê½‰ */
		 box-sizing: border-box;    /* íŒ¨ë”© í¬í•¨ ê³„ì‚° */
		 border: none;
		 background-color: #00FF08;
		 color: black;
		 cursor: pointer;
		 font-size: 14px;
		 font-weight: 300; /* ê¸€ì”¨ êµµê¸° ë³´í†µìœ¼ë¡œ */
		 text-decoration: none;
	  }

	  .container {
	  	      display: grid;
	  	      grid-template-columns: 1fr 1fr; /* ì™¼ìª½, ì˜¤ë¥¸ìª½ */
	  	      gap: 5px;
	  	      height: calc(100vh - 130px); /* ìƒë‹¨+ì¤‘ì•™+í•˜ë‹¨ í—¤ë” ì œì™¸ */
	  	      padding: 5px;
	  	      box-sizing: border-box;
	  }
	  
	  .user{
		 grid-column: 1/2;
	  }
	  
	  .calendar{
		 grid-column: 2/3;
	  }
	  
	  .fc-event-title {  /*ìº˜ë¦°ë” ì¤„ë„ì–´ì“°ê¸°*/
  	        white-space: pre-line;
  	   }
	</style>
	
	<!-- FullCalendar CSS/JS -->
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
	
</head>
<body>
    <header class="main-header">
		<!-- ìƒë‹¨ í—¤ë” -->
        <div class="top-bar">
            <div class="user-info">
                <span>(ì•„ì´ì½˜)</span>
                <span>MediCare |</span>
				<span>ì‚¬ìš©ìID:<span>
					<span id="user_id" th:text="${username}"></span>
	
            </div>
            <div class="user-info">
                <span>ì§„ë£Œê³¼ ã…‡ã…‡ã…‡</span>
				<button class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
			</div>
            <div class="action-buttons">
                <button class="time-in">ì¶œê·¼</button>
                <button class="time-out">í‡´ê·¼</button>
            </div>
        </div>
		<!-- ìƒë‹¨ í—¤ë” ë-->
		
		<!-- ì¤‘ì•™ í—¤ë”-->
        <nav class="nav-tabs">
            <ul class="tab-list">
				<li class="tab-item"><a th:href="@{/hr/allSchedule}">ì§ì› ìŠ¤ì¼€ì¤„ ì¡°íšŒ</a></li>
                <li class="tab-item"><a th:href="@{/hr/vacationList}">íœ´ê°€ ì‹ ì²­ ë¦¬ìŠ¤íŠ¸</a></li>
                <li class="tab-item"><a th:href="@{/hr/scheduleAssignment}">ìŠ¤ì¼€ì¤„ ë¶€ì—¬</a></li>
                <li class="tab-item active"><a th:href="@{/hr/allWork}">ê·¼íƒœ í˜„í™©</a></li>
            </ul>
        </nav>
		<!-- ì¤‘ì•™ í—¤ë” ë-->
		
		<!-- í•˜ë‹¨ í—¤ë”-->
        <div class="sub-menu">
            <span>ê·¼íƒœ í˜„í™©</span>
        </div>
		<!-- í•˜ë‹¨ í—¤ë” ë-->
    </header>

	<!-- ì½˜í…ì¸  ì˜ì—­ ì‹œì‘-->
    <div class="content-area">
		<div class="container">
			<div class="user"> <!-- ì§ì› ì˜ì—­-->
				<!-- ğŸ” ê²€ìƒ‰ ì˜ì—­ -->
				<form method="get" action="/hr/allWork" style="margin-bottom:10px;">
				    <!-- ì§„ë£Œê³¼ -->
				    <select name="departmentCode">
				        <option value="">ì§„ë£Œê³¼ ì „ì²´</option>
				        <option th:each="d : ${departments}"
				                th:value="${d.department_code}"
				                th:text="${d.name}"
				                th:selected="${d.department_code == departmentCode}">
				        </option>
				    </select>

				    <!-- ì§ì› ID / ì´ë¦„ -->
				    <input type="text"
				           name="keyword"
				           placeholder="ì§ì›ëª… / ID"
				           th:value="${keyword}"/>

				    <button type="submit">ê²€ìƒ‰</button>
				</form>

				
				<table class="user-table">
			        <thead>
			            <tr>
			                <th>ì§„ë£Œê³¼</th>
			                <th>ì§ì› ID</th>
			                <th>ì§ì›ëª…</th>
			                <th>ì§í•¨</th>
			                <th>ì„ íƒ</th>
			            </tr>
			        </thead>

			        <tbody>
			            <tr th:each="u : ${user}">
			                <!-- ì§„ë£Œê³¼ëª… -->
			                <td th:text="${u.staff_profile[0].department.name}">
			                </td>

			                <!-- ì§ì› ID -->
			                <td th:text="${u.user_id}"></td>

			                <!-- ì§ì›ëª… -->
			                <td th:text="${u.name}"></td>

			                <!-- ì§í•¨ (nullì´ë©´ ë¹ˆì¹¸) -->
			                <td th:text="${u.staff_profile[0].position}">
			                </td>

			                <!-- ì„ íƒ ë²„íŠ¼ -->
			                <td>
			                    <button type="button"
			                            class="select-user-btn"
			                            th:data-user-id="${u.user_id}">
			                        ì„ íƒ
			                    </button>
			                </td>
			            </tr>
			        </tbody>
				</table>		
			</div>
			
			<div class="calendar"> <!-- ìº˜ë¦°ë” ì˜ì—­-->
				<div id="calendar-placeholder">ì§ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
				<div id="calendar" style="display:none;"></div>
			</div>
		</div>
	</div>
	<!-- ì½˜í…ì¸  ì˜ì—­ ë-->
	<script>
	let calendar;
	let selectedUserId = null;

	document.addEventListener('DOMContentLoaded', function () {

	    const calendarEl = document.getElementById('calendar');

	    calendar = new FullCalendar.Calendar(calendarEl, {
	        initialView: 'dayGridMonth',
	        locale: 'ko',
	        height: 'auto',

	        headerToolbar: {
	            left: 'prev,next today',
	            center: 'title',
	            right: ''
	        },

	        // ë‹¬ ë³€ê²½ë  ë•Œë§ˆë‹¤ í˜¸ì¶œ
	        datesSet: function (info) {

	            // ì§ì› ì„ íƒ ì•ˆ í–ˆìœ¼ë©´ ì¡°íšŒ ì•ˆ í•¨
	            if (!selectedUserId) return;

	            const currentDate = info.view.currentStart;
	            const year = currentDate.getFullYear();
	            const month = currentDate.getMonth() + 1;

				fetch(`/hr/allWork/schedule?userId=${selectedUserId}&year=${year}&month=${month}`)
	                .then(res => res.json())
	                .then(data => {
	                    calendar.removeAllEvents();
	                    calendar.addEventSource(data);
	                });
	        }
	    });

	    calendar.render();

	    // ì§ì› ì„ íƒ ë²„íŠ¼
	    document.querySelectorAll('.select-user-btn').forEach(btn => {
	        btn.addEventListener('click', () => {

	            selectedUserId = btn.dataset.userId;

	            // ì•ˆë‚´ ë¬¸êµ¬ ì œê±°
	            document.getElementById('calendar-placeholder')?.remove();
				
				// ìº˜ë¦°ë” ë³´ì´ê¸°
				document.getElementById('calendar').style.display = 'block';

	            // í˜„ì¬ ë‹¬ ê¸°ì¤€ìœ¼ë¡œ ê°•ì œ ì¡°íšŒ
	            calendar.gotoDate(calendar.getDate());
	        });
	    });
	});
	</script>


	


</body>
</html>