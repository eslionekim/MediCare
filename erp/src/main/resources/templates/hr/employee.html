<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MediCare</title>
	<!-- 구글 폰트 링크 -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>/* 전체 리셋 및 기본 배경 */
	/* html, body 화면 전체 사용 */
	html, body {
	    margin: 0;
	    padding: 0;
	    height: 100%; /* 화면 전체 높이 */
	    font-family: 'Inter', '맑은 고딕', sans-serif;
	    background-color: #D5DDED;
	    overflow: hidden; /* body 스크롤 제거 */
	}
	
	
	/* 상단 헤더 배경 및 레이아웃 */
	.top-bar {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    padding: 5px 15px;
	    background-color: #ffffff; /* 흰색 배경 */
	    font-size: 14px;
	}
	
	/* 상단 헤더 텍스트 스타일 */
	.user-info {
	    color: #555;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 배열 */
	.action-buttons {
	    display: flex;
	    gap: 5px;
	}
	
	/* 상단 헤더 -> 로그아웃 출근 퇴근 공통스타일 */
	.action-buttons button {
	    padding: 4px 12px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-weight: 500;
	    font-size: 13px;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 로그아웃 버튼 스타일 */
	.btn-logout {
		padding: 4px 12px;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-weight: 500;
		font-size: 13px;
		color: white;
	    background-color: #FF4B4B;
		border: 1px solid #7B7B7B;
	}
	
	/* 상단 헤더 -> 출근 버튼 스타일 */
	.time-in {
	    background-color: #879BD5;
		color:#ffffff;
	}
	
	/* 상단 헤더 -> 퇴근 버튼 스타일 */
	.time-out {
	    background-color: #D5DDED;
	    color: #000;
	}

	/* 중앙 헤더 -> 카테고리 배치 */
	.tab-list {
	    list-style: none; /* 앞에 점 제거*/
	    margin: 0;
	    padding: 0;
	    display: flex; /* 가로 나열*/
	}
	
	/* 중앙 헤더 -> 카테고리 요소 스타일 */
	.tab-item a {
	    display: block;
	    padding: 8px 15px;
	    text-decoration: none; /* 카테고리 밑줄 제거*/
	    color: #333; /* 글자 색*/
	    background-color: transparent; /* 배경색 투명 (nav-tabs의 배경색 사용) */
	    border: none; /* 경계선 제거 */
	    font-size: 14px;
	    font-weight: normal;
	}
	
	/* 2. 중앙 헤더 공통 ⭐ */
	.nav-tabs {
		background-color: #D5DDED; /* 이미지의 균일한 하늘색 배경 */
		padding: 0 10px;
	}
	
	/* 중앙 헤더 -> 카테고리 호버 */
	.tab-item:hover {
	    background-color: rgba(255, 255, 255, 0.3); /* 마지막 숫자가 컬러 세기 정도*/
	}
	
	/* 중앙 헤더 -> 선택된 카테고리 스타일 */
	.tab-item.active a {
	    color: #333; /* 텍스트 색상은 검은색 유지 (사진처럼) */
	    font-weight: 550;
	    /* 하단에 진한 파란색 선으로 강조 */
	}
	
	
	/* 3. 하단 헤더  */
	.sub-menu {
	    background-color: #BACCFF; /* 흰색 배경 */
	    padding: 5px 15px; /* 패딩을 줄여서 메뉴와 붙은 느낌 */
	    font-size: 14px;
	    color: #555;
		font-weight: 530;
	    /* 이미지처럼 '금일 진료 리스트' 텍스트를 진하게 표현 */
		margin-bottom: 0;
	}
	
	/* 컨텐츠 영역 (전체 배경색 확인용) */
	.content-area {
	    background-color: #ffffff;   /* 흰색 */
	    margin: 0 auto;              /* 중앙 정렬 */
	    padding: 1px 0 30px 0;
	    height: 100%; /* body 높이 꽉 채움 */
	    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05); /* 위쪽 살짝 그림자 */
	}

	
	table { 
	    width: 99%; /* 너비 */
	    border-collapse: collapse; /* 표 한줄로 합치기 */
	    font-size: 14px;
	    background-color: white;
		
	 }

	 

	 tr:nth-child(even) {
	     background-color: #ffffffff;
	 }


	  /* 테이블 드롭다운 고급 느낌 */
	  .select-wrapper {
	      position: relative;
	      display: inline-block;
	  }

	  .select-wrapper::after {
	      position: absolute;
	      right: 6px;
	      top: 50%;
	      transform: translateY(-50%);
	      pointer-events: none;
	      font-size: 10px;
	      color: #879BD5;
	  }
	  
	  .visit-table-box {
	      background: #f7f9ff;
	      border: 1px solid #b0b7c7;
	      border-radius: 4px;
	      height: 520px;
	      overflow-y: auto;
	      margin-top: 10px;
	      padding: 10px;
	  }

	  .visit-table-box table {
	      width: 100%;
	      border-collapse: collapse;
	      font-size: 13px;
	  }

	  .visit-table-box th, .visit-table-box td {
	      border: 1px solid #ccc;
	      padding: 6px;
	      text-align: center;
	  }

	  .visit-table-box th {
	      background: #f3f6ff;
	      font-weight: 600;
	  }

	  .visit-table-box a.first {
	      display: inline-block;
	      padding: 4px 8px;
	      background: #879BD5;
	      color: #fff;
	      border-radius: 4px;
	      text-decoration: none;
	      font-size: 12px;
	  }

	  .visit-table-box span {
	      font-size: 12px;
	      color: #7B7B7B;
	  }

	  .visit-table-box .no-data {
	      text-align: center;
	      font-size: 13px;
	      color: #7B7B7B;
	      height: 500px;
	      line-height: 500px;
	  }
	  .select-wrapper {
	      display: flex;
	      justify-content: flex-end;
	      width: 90%;
	      margin: 5px auto;
	      position: relative; /* 커스텀 화살표 위치용 */
	  }

	  .select-wrapper select {
	      width: 100px; /* 필요하면 조절 */
	      padding: 5px 0px;
	      font-size: 12px;
	      border-radius: 2px; /* 동글동글 */
	      border: 1px solid #b0b7c7; /* 연한 회색 테두리 */
	      background-color: #fff; /* 흰색 배경 */
	      cursor: pointer;
	      appearance: none; /* 기본 브라우저 화살표 제거 */
	  }

	  /* 화살표 */
	  .select-wrapper::after {
	      content: "▾"; 
	      position: absolute;
	      right: 10px;
	      top: 50%;
	      transform: translateY(-50%);
	      pointer-events: none;
	      font-size: 12px;
	      color: #879BD5; /* 친구 테이블 느낌 파랑 계열 */
	  }
	  
	  /* 드롭다운 옆 버튼 */
	  .btn-submit {
	      padding: 5px 12px;
	      background-color: #879BD5;
	      color: #fff;
	      border: none;
	      border-radius: 4px;
	      font-size: 13px;
	      cursor: pointer;
	      font-weight: 500;
	      transition: 0.2s;
	  }

	  .btn-submit:hover {
	      background-color: #6a86c7;
	  }

	  #vacationPopup {
	      display: none;
	      position: fixed;
	      top: 20%;
	      left: 50%;
	      width: 200px;
	      background: #f7f9ff;
	      border-radius: 8px;
	      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
	      padding: 20px;
	      z-index: 1000;
	      font-size: 14px;
	  }

	  #vacationPopup h2 {
	      margin-top: 0;
	      margin-bottom: 30px;
	      font-size: 16px;
	      color: #333;
	  }

	  #vacationPopup label {
	      display: block;
	      margin-top: 10px;
	      margin-bottom: 5px;
	      font-weight: 500;
	  }

	  #vacationPopup input,textarea, #vacationPopup select {
	      width: 100%;
	      padding: 5px 8px;
	      font-size: 14px;
	      border-radius: 4px;
	      border: 1px solid #b0b7c7;
	      margin-bottom: 5px;
	      box-sizing: border-box;
	  }

	  #vacationPopup button {
	      padding: 6px 12px;
	      border: none;
	      border-radius: 4px;
	      cursor: pointer;
	      font-weight: 500;
	      margin-right: 10px;
	  }

	  #submitVacation {
	      background-color: #879BD5;
	      color: #fff;
	  }

	  #closePopup {
	      background-color: #ccc;
	      color: #333;
	  }

	</style>
	<script>
		document.addEventListener('DOMContentLoaded', () => {

		    document.querySelector('.time-in').addEventListener('click', () => { //출근 처리
		        fetch('/work/time-in', { method: 'POST' })
		            .then(res =>
		                res.text().then(msg => {
		                    if (!res.ok) throw msg;
		                    alert(msg);
		                })
		            )
		            .catch(msg => alert(msg));
		    });

			document.querySelector('.time-out').addEventListener('click', () => { //퇴근 처리

				fetch('/work/time-out/check')
				        .then(res =>
				            res.text().then(msg => {
				                if (!res.ok) throw msg; // 퇴근 불가능

				                if (!confirm('퇴근하시겠습니까?')) return;

				                fetch('/work/time-out', { method: 'POST' }) // 예를 눌러야 실행
				                    .then(res => res.text())
				                    .then(msg => alert(msg))
				                    .catch(() => alert('퇴근 처리 실패'));
				            })
				        )
				        .catch(msg => alert(msg));
			});
		});
	</script>
</head>
<body>
    <div th:replace="~{fragments/hr-header :: header(title='직원 리스트', activeTab='employee')}"></div>

	<!-- 콘텐츠 영역 시작-->
    <div class="content-area">
		<!-- 상태 필터링 -->
		<div class="select-wrapper" style="width:90%; margin: 5px auto; display:flex; justify-content:flex-end;">
			<button id="openPopupBtn" class="btn-submit">직원 등록</button>
			<form method="get" th:action="@{/hr/employee}" style="display:flex; gap:8px;">
			    <!-- 근무과 -->
			    <select name="department">
			        <option value="">전체 근무과</option>
			        <option th:each="d : ${departments}"
			                th:value="${d}"
			                th:text="${d}"
			                th:selected="${d == selectedDepartment}">
			        </option>
			    </select>

			    <!-- 키워드 -->
			    <input type="text"
			           name="keyword"
			           placeholder="직원 ID / 직원명"
			           th:value="${keyword}" />

			    <!-- 입사일 -->
			    <input type="date"
			           name="hireDate"
			           th:value="${hireDate}" />

			    <button type="submit">검색</button>
			</form>

		</div>

		<!-- 금일 진료 리스트 -->
		<div class="visit-table-box">
		<table id="table" border="1">
			<thead>
			    <tr>
			        <th>ID</th>
			        <th>직원명</th>
			        <th>근무과</th>
			        <th>입사일</th>
					<!--<th>수정</th>-->
			    </tr>
			</thead>

			<tbody>
			    <tr th:each="sp : ${staffList}">
			        <td th:text="${sp.user_account.user_id}"></td>

			        <td th:text="${sp.user_account.name}"></td>

			        <td th:text="${sp.department.name}"></td>

			        <!-- 입사일 없으면 '-' -->
			        <td th:text="${sp.hire_date != null ? sp.hire_date : '-'}"></td>
					<!--
			        <td>
			            <button type="button"
			                    th:attr="data-id=${sp.staff_profile_id}">
			                수정
			            </button>
			        </td>-->
			    </tr>
			    </tbody>
		</table>
		</div>

		
		<!-- 팝업 -->
		<div id="vacationPopup" style="display:none; position:fixed; top:20%; left:30%; width:40%; background:#fff; border:1px solid #ccc; padding:20px; z-index:1000;">
		    <h2>직원 등록</h2>
			
			<label>이름</label>
		    <input type="text" id="name" required></input>
			<label>아이디</label>
		    <input type="text" id="userId" required></input>
			<label>비밀번호</label>
		    <input type="text" id="password" required></input>
		    <label>입사일</label>
		    <input type="date" id="hire_date" required>
		    
			<label>진료과</label>
			<select id="department" required>
			    <option value="">선택하세요</option>
			    <option th:each="d : ${departments}"
			            th:value="${d.name}"
			            th:text="${d.name}">
			    </option>
			</select>
		    <br><br>
		    
		    <button id="submitVacation">등록</button>
		    <button id="closePopup">이전</button>
		</div>
		
		
    </div>
	<!-- 콘텐츠 영역 끝-->
	<script>
		// 팝업 열기
	    document.getElementById("openPopupBtn").onclick = function() {
	        document.getElementById("vacationPopup").style.display = "block";
	    };
	
	    // 팝업 닫기
	    document.getElementById("closePopup").onclick = function() {
	        document.getElementById("vacationPopup").style.display = "none";
	    };
	
	    
		
		document.getElementById("submitVacation").addEventListener("click", function () {
	
		    const data = {
		        userId: document.getElementById("userId").value,
		        name: document.getElementById("name").value,
		        password: document.getElementById("password").value,
		        hireDate: document.getElementById("hire_date").value,
		        departmentName: document.getElementById("department").value
		    };
	
		    fetch("/hr/employee", {
		        method: "POST",
		        headers: {
		            "Content-Type": "application/json"
		        },
		        body: JSON.stringify(data)
		    })
			.then(res => res.text())  
			.then(data => console.log(data));
		});
		</script>
	
</body>
</html>